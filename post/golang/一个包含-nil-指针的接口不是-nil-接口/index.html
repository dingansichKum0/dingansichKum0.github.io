<!DOCTYPE html>
<html lang="en"><head>
    <title>rx-78-kum0</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000084" />
    <link rel="icon" href="https://rx-78-kum0.github.io//favicon.ico">
    <link rel="canonical" href="https://rx-78-kum0.github.io/">
    
    
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></button>
            <a class="brand" href="https://rx-78-kum0.github.io/">rx-78-kum0</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                    
                        
                            <li>
                                <a href="/post/">
                                    
                                    <span>Posts</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/about/">
                                    
                                    <span>About</span>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>
</nav><div id="content" class="container">

<div class="row-fluid navmargin">
    <div class="page-header">
        <h1>一个包含 nil 指针的接口不是 nil 接口 - Mon, Mar 25, 2019</h1>
    </div>
    <p class="lead">golang 接口值: 一个包含 nil 指针的接口不是 nil 接口.</p>
    <blockquote>
<p>golang 接口值: 一个包含 nil 指针的接口不是 nil 接口.</p>
<p>一个不包含任何值的 nil 接口值和一个刚好包含 nil 指针的接口值是不同的.</p>
</blockquote>
<p>接口值由两个部分组成:</p>
<ul>
<li>一个具体的类型</li>
<li>那个类型的值</li>
</ul>
<p>它们被称为接口的动态类型和动态值.</p>
<table>
<thead>
<tr>
<th>type</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>x</td>
<td>x</td>
</tr>
</tbody>
</table>
<p>接口的零值是指动态类型为nil, 动态值也为nil.</p>
<table>
<thead>
<tr>
<th>type</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>nil</td>
<td>nil</td>
</tr>
</tbody>
</table>
<p>这样的接口才能满足 <strong>接口值 == nil</strong>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#66d9ef">interface</span>{}
<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// true
</span></code></pre></div><h2 id="一个不包含任何值的-nil-接口值">一个不包含任何值的 nil 接口值:</h2>
<p>interface 类型变量的动态类型和动态值都为 nil.
比如 nil, 或者:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#66d9ef">interface</span>{}
<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>) <span style="color:#75715e">// a为nil
</span></code></pre></div><h2 id="一个刚好包含-nil-指针的接口值">一个刚好包含 nil 指针的接口值:</h2>
<p>赋值给后，interface 类型变量的动态类型不为 nil，动态值为 nil.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#66d9ef">interface</span>{}
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">string</span>
<span style="color:#a6e22e">a</span> = <span style="color:#a6e22e">b</span>
<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>) <span style="color:#75715e">// 此时a的动态类型为*string，动态值为nil
</span></code></pre></div><h2 id="这两种对象比较">这两种对象比较:</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>(){
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#66d9ef">interface</span>{} <span style="color:#75715e">// nil
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">string</span>     <span style="color:#75715e">// nil
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">a</span> = <span style="color:#a6e22e">b</span>

  <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// false
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">b</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// true
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">b</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">a</span>)   <span style="color:#75715e">// true
</span><span style="color:#75715e"></span>}
</code></pre></div><ol>
<li>
<p>a <code>= nil 为 false: b 赋值给 a, a 的动态类型为 *string, 动态值为 nil, 所以 a =</code> nil 为 false.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 空接口
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">eface</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">_type</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">_type</span>         <span style="color:#75715e">// 类型信息
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">data</span>  <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span> <span style="color:#75715e">// 指向数据的指针
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">// 带有方法的接口
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">iface</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">tab</span>  <span style="color:#f92672">*</span><span style="color:#a6e22e">itab</span>           <span style="color:#75715e">// 存储type信息还有结构实现方法的集合
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>  <span style="color:#75715e">// 指向数据的指针
</span><span style="color:#75715e"></span>}
</code></pre></div></li>
</ol>
<p>根据 interface 的底层实现,  a = b 实则是 a.data = unsafe.Pointer(&amp;b). a = nil 才是 a.data = nil.</p>
<ol>
<li>
<p>b == nil 为 true: b 是一个空的指针(非接口)类型.</p>
</li>
<li>
<p>b == a 为 true: 值都为 nil, b 是一个空的指针(非接口)类型.</p>
</li>
</ol>

    <h4><a href="https://rx-78-kum0.github.io/">Back to Home</a></h4>
</div>


        </div><footer class="container">
    <hr class="soften">
    <p>

&copy; 

    JM Fergeau

<span id="thisyear">2020</span>

</p>
    <p class="text-center">
        
        
        
        <a href="https://github.com/rx-78-kum0">GitHub</a> 
        
    </p>
</footer>

</body><link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet" href="/css/bootstrap-responsive.css">
<link rel="stylesheet" href="/css/style.css">
<script src="/js/jquery.js"></script>
<script src="/js/bootstrap-386.js"></script>
<script src="/js/bootstrap-transition.js"></script>
<script src="/js/bootstrap-alert.js"></script>
<script src="/js/bootstrap-modal.js"></script>
<script src="/js/bootstrap-dropdown.js"></script>
<script src="/js/bootstrap-scrollspy.js"></script>
<script src="/js/bootstrap-tab.js"></script>
<script src="/js/bootstrap-tooltip.js"></script>
<script src="/js/bootstrap-popover.js"></script>
<script src="/js/bootstrap-button.js"></script>
<script src="/js/bootstrap-collapse.js"></script>
<script src="/js/bootstrap-carousel.js"></script>
<script src="/js/bootstrap-typeahead.js"></script>
<script src="/js/bootstrap-affix.js"></script>
<script>
    _386 = { 
        fastLoad: true ,
        onePass: true , 
        speedFactor: 5 
    };

    
    function ThisYear() {
        document.getElementById('thisyear').innerHTML = new Date().getFullYear();
    };
</script></html>
