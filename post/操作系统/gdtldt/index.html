<!DOCTYPE html>
<html lang="en"><head>
    <title>rx-78-kum0</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000084" />
    <link rel="icon" href="https://rx-78-kum0.github.io//favicon.ico">
    <link rel="canonical" href="https://rx-78-kum0.github.io/">
    
    
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></button>
            <a class="brand" href="https://rx-78-kum0.github.io/">rx-78-kum0</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                    
                        
                            <li>
                                <a href="/post/">
                                    
                                    <span>Posts</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/about/">
                                    
                                    <span>About</span>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>
</nav><div id="content" class="container">

<div class="row-fluid navmargin">
    <div class="page-header">
        <h1>GDT&amp;LDT - Thu, Jun 11, 2020</h1>
    </div>
    <p class="lead">GDT&amp;LDT</p>
    <h2 id="gdt--global-descriptor-table--全局描述符表ⅰ">GDT(Global Descriptor Table)全局描述符表Ⅰ</h2>
<p>GDT是一个以 <strong>段描述符</strong> 为表项的数组类型的数据结构，在内存中线性存放。每个段描述符占 8 个字节。</p>
<p>GDTR寄存器存放GDT表的基地址和表长界限(高32位存放GDT基址，低16为存放GDT限长)。指令LGDT和SGDT分别用于加载和保存GDTR寄存器的内容。在机器刚加电或处理器复位后，基地址被默认地设置为0，而长度值被设置成0xFFFF。在保护模式初始化过程中必须给GDTR加载一个新值。</p>
<h2 id="段选择子--segement-selector">段选择子(Segement Selector)</h2>
<p>由GDTR访问全局描述符表是通过“段选择子”(实模式下的段寄存器)来完成的。段选择子是一个16位的寄存器(同实模式下的段寄存器相同)。</p>
<h3 id="段选择子共16bit-由三部分组成-描述符索引--index--ti-请求特权级--rpl">段选择子共16bit，由三部分组成: 描述符索引(index)、TI、请求特权级(RPL)</h3>
<ul>
<li>描述符索引(index): 在描述符表中定位一个段描述符。</li>
<li>TI: 描述符表指示器， TI＝0 时，表示描述符在 GDT 中； TI＝1 时，描述符在 LDT 中。</li>
<li>RPL: 请求特权级，表示给出当前选择子访问的内存段的特权级别。每一个段都有一个特定的级别。每当一个程序试图访问某一个段时，就将该程序所拥有的特权级与要访问的特权级进行比较，以决定能否访问该段。系统约定，CPU只能访问同一特权级或级别较低特权级的段。</li>
</ul>
<h3 id="因为每个描述符占-8-字节-因此描述符在表内的偏移地址是索引号乘以-8">因为每个描述符占 8 字节，因此描述符在表内的偏移地址是索引号乘以 8</h3>
<p>处理器在执行任何改变段选择器的指令时(比如 pop、 mov、jmp far、 call far、 iret、 retf)，就将指令中提供的索引号乘以 8 作为偏移地址，同 GDTR 中提供的线性基地址相加，以访问 GDT。在表内找到的描述符，并加载到不可见的描述符高速缓存部分。此后每当有访问内存的指令时，就不再访问 GDT 中的描述符，直接用当前段寄存器描述符高速缓存器提供线性基地址。</p>
<h2 id="段描述符--segment-descriptor">段描述符(Segment Descriptor)</h2>
<p>每个段描述符占 8 个字节。由三部分组成: 线性基地址、段界限和段的访问属性。</p>
<figure>
    <img src="/ox-hugo/2020-06-12_18-50-34_929457-20161230154447711-2105143159.png"/> 
</figure>

<ul>
<li>
<p>G: 粒度位，用于解释段界限的含义。当 G 位是&quot;0&quot;时，段界限以字节为单位。此时，段的扩展范围是从 1 字节到 1 兆字节（ 1B～1MB），因为描述符中的界限值是 20 位的。相反，如果该位是&quot;1&rdquo;，那么，段界限是以 4KB 为单位的。这样，段的扩展范围是从 4KB到 4GB。</p>
</li>
<li>
<p>D/B: &ldquo;默认的操作数大小&rdquo;(Default Operation Size)或者&quot;默认的堆栈指针大小&rdquo;，又或者&quot;上部边界&quot;标志。设立该标志位，主要是为了能够在 32 位处理器上兼容运行 16 位保护模式的程序。D＝0 表示指令中的偏移地址或者操作数是 16 位的； D＝1，指示 32 位的偏移地址或者操作数。</p>
</li>
<li>
<p>L:  64 位代码段标志。保留此位给 64 位处理器使用。32位将此位置&quot;0&rdquo;。</p>
</li>
<li>
<p>AVL: 保留位。可以被系统软件使用。</p>
</li>
<li>
<p>P: 段存在位(Segment Present)。 P 位用于指示描述符所对应的段是否存在。一般来说，描述符所指示的段都位于内存中。但是，当内存空间紧张时，有可能只是建立了描述符，对应的内存空间并不存在，这时，就应当把描述符的 P 位清零，表示段并不存在。P 位是由处理器负责检查的。每当通过描述符访问内存中的段时，如果 P 位是&quot;0&rdquo;，处理器就会产生一个异常中断。</p>
</li>
<li>
<p>DPL: 描述符的特权级(Descriptor Privilege Level， DPL)。这两位用于指定段的特权级。共有 4 种处理器支持的特权级别，分别是 0、 1、 2、 3，其中 0 是最高特权级别， 3 是最低特权级别。刚进入保护模式时执行的代码具有最高特权级 0(可以看成是从处理器那里继承来的)，这些代码通常都是操作系统代码(内核段)，因此它的特权级别最高。每当操作系统加载一个用户程序时，它通常都会指定一个稍低的特权级(用户段)，比如 3 特权级。不同特权级别的程序是互相隔离的，其互访是严格限制的，而且有些处理器指令(特权指令)只能由 0 特权级的程序来执行，为的就是安全。这里再次点明了为何叫保护模式。</p>
</li>
<li>
<p>S: 用于指定描述符的类型(Descriptor Type)。当该位是&quot;0&quot;时，表示是一个系统段；为&quot;1&quot;时，表示是一个代码段或者数据段(堆栈段也是特殊的数据段)。</p>
</li>
<li>
<p>TYPE: 共 4 位，用于指示描述符的子类型，或者说是类别。</p>
</li>
</ul>
<h3 id="描述符类型">描述符类型</h3>
<figure>
    <img src="/ox-hugo/2020-06-12_18-48-27_929457-20161230155710164-891968633.png"/> 
</figure>


    <h4><a href="https://rx-78-kum0.github.io/">Back to Home</a></h4>
</div>


        </div><footer class="container">
    <hr class="soften">
    <p>

&copy; 

    JM Fergeau

<span id="thisyear">2020</span>

</p>
    <p class="text-center">
        
        
        
        <a href="https://github.com/rx-78-kum0">GitHub</a> 
        
    </p>
</footer>

</body><link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet" href="/css/bootstrap-responsive.css">
<link rel="stylesheet" href="/css/style.css">
<script src="/js/jquery.js"></script>
<script src="/js/bootstrap-386.js"></script>
<script src="/js/bootstrap-transition.js"></script>
<script src="/js/bootstrap-alert.js"></script>
<script src="/js/bootstrap-modal.js"></script>
<script src="/js/bootstrap-dropdown.js"></script>
<script src="/js/bootstrap-scrollspy.js"></script>
<script src="/js/bootstrap-tab.js"></script>
<script src="/js/bootstrap-tooltip.js"></script>
<script src="/js/bootstrap-popover.js"></script>
<script src="/js/bootstrap-button.js"></script>
<script src="/js/bootstrap-collapse.js"></script>
<script src="/js/bootstrap-carousel.js"></script>
<script src="/js/bootstrap-typeahead.js"></script>
<script src="/js/bootstrap-affix.js"></script>
<script>
    _386 = { 
        fastLoad: true ,
        onePass: true , 
        speedFactor: 5 
    };

    
    function ThisYear() {
        document.getElementById('thisyear').innerHTML = new Date().getFullYear();
    };
</script></html>
